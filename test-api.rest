### Variables
@baseUrl = http://localhost:3000
@orgId = REPLACE_WITH_CREATED_ID
@userId = REPLACE_WITH_CREATED_USER_ID
@courseId = REPLACE_WITH_CREATED_COURSE_ID
@accessToken = REPLACE_WITH_JWT_TOKEN

### 1. Créer une organisation
POST {{baseUrl}}/organizations
Content-Type: application/json

{
  "name": "Krav Maga Lyon Centre",
  "slug": "krav-maga-lyon-centre",
  "email": "contact@kravlyon.fr",
  "phone": "0612345678",
  "address": "123 rue de la République, 69002 Lyon"
}

### 2. Récupérer toutes les organisations
GET {{baseUrl}}/organizations

### 3. Récupérer une organisation par ID
GET {{baseUrl}}/organizations/{{orgId}}

### 4. Récupérer une organisation par slug
GET {{baseUrl}}/organizations/slug/krav-maga-lyon-centre

### 5. Mettre à jour une organisation
PATCH {{baseUrl}}/organizations/{{orgId}}
Content-Type: application/json

{
  "name": "Krav Maga Lyon Centre - Updated",
  "phone": "0698765432"
}

### 6. Supprimer une organisation (soft delete)
DELETE {{baseUrl}}/organizations/{{orgId}}

### 7. Restaurer une organisation
POST {{baseUrl}}/organizations/{{orgId}}/restore

### 8. Test validation - Devrait échouer (slug invalide)
POST {{baseUrl}}/organizations
Content-Type: application/json

{
  "name": "Test Org",
  "slug": "TEST_INVALID_SLUG!",
  "email": "test@example.com"
}

###############################################################################
# USERS ENDPOINTS
###############################################################################

### 9. Créer un utilisateur admin
POST {{baseUrl}}/users
Content-Type: application/json

{
  "organization_id": "{{orgId}}",
  "email": "admin@kravlyon.fr",
  "password": "SecurePassword123!",
  "first_name": "Jean",
  "last_name": "Dupont",
  "phone": "0612345678",
  "date_of_birth": "1985-05-15",
  "role": "admin",
  "status": "active"
}

### 10. Créer un utilisateur coach
POST {{baseUrl}}/users
Content-Type: application/json

{
  "organization_id": "{{orgId}}",
  "email": "coach@kravlyon.fr",
  "password": "SecurePassword123!",
  "first_name": "Marie",
  "last_name": "Martin",
  "phone": "0698765432",
  "role": "coach"
}

### 11. Créer un membre
POST {{baseUrl}}/users
Content-Type: application/json

{
  "organization_id": "{{orgId}}",
  "email": "membre@example.com",
  "password": "SecurePassword123!",
  "first_name": "Pierre",
  "last_name": "Durand",
  "role": "member"
}

### 12. Récupérer tous les utilisateurs
GET {{baseUrl}}/users

### 13. Récupérer tous les utilisateurs d'une organisation
GET {{baseUrl}}/users?organizationId={{orgId}}

### 14. Récupérer tous les coachs d'une organisation
GET {{baseUrl}}/users/organization/{{orgId}}?role=coach

### 15. Récupérer tous les membres d'une organisation
GET {{baseUrl}}/users/organization/{{orgId}}?role=member

### 16. Récupérer un utilisateur par ID
GET {{baseUrl}}/users/{{userId}}

### 17. Mettre à jour un utilisateur
PATCH {{baseUrl}}/users/{{userId}}
Content-Type: application/json

{
  "first_name": "Jean-Updated",
  "phone": "0611223344"
}

### 18. Changer le mot de passe d'un utilisateur
PATCH {{baseUrl}}/users/{{userId}}/password
Content-Type: application/json

{
  "newPassword": "NewSecurePassword456!"
}

### 19. Supprimer un utilisateur (soft delete)
DELETE {{baseUrl}}/users/{{userId}}

### 20. Restaurer un utilisateur
POST {{baseUrl}}/users/{{userId}}/restore

### 21. Test validation - Devrait échouer (mot de passe trop court)
POST {{baseUrl}}/users
Content-Type: application/json

{
  "organization_id": "{{orgId}}",
  "email": "test@example.com",
  "password": "short",
  "first_name": "Test",
  "last_name": "User",
  "role": "member"
}

### 22. Test validation - Devrait échouer (email invalide)
POST {{baseUrl}}/users
Content-Type: application/json

{
  "organization_id": "{{orgId}}",
  "email": "not-an-email",
  "password": "SecurePassword123!",
  "first_name": "Test",
  "last_name": "User",
  "role": "member"
}

### 23. Test validation - Devrait échouer (rôle invalide)
POST {{baseUrl}}/users
Content-Type: application/json

{
  "organization_id": "{{orgId}}",
  "email": "test@example.com",
  "password": "SecurePassword123!",
  "first_name": "Test",
  "last_name": "User",
  "role": "super-admin"
}

###############################################################################
# COURSES ENDPOINTS
###############################################################################

### 24. Créer un cours simple
POST {{baseUrl}}/courses
Content-Type: application/json

{
  "organization_id": "{{orgId}}",
  "title": "Krav Maga Débutants",
  "description": "Cours pour débutants - techniques de base",
  "course_type": "krav-maga",
  "start_datetime": "2025-11-03T18:00:00Z",
  "end_datetime": "2025-11-03T19:30:00Z",
  "location": "Dojo Principal",
  "coach_id": "{{userId}}",
  "max_capacity": 20,
  "status": "scheduled"
}

### 25. Créer un cours récurrent (tous les lundis)
POST {{baseUrl}}/courses
Content-Type: application/json

{
  "organization_id": "{{orgId}}",
  "title": "Krav Maga Avancés - Lundi",
  "description": "Cours avancé tous les lundis",
  "course_type": "krav-maga",
  "start_datetime": "2025-11-03T19:45:00Z",
  "end_datetime": "2025-11-03T21:15:00Z",
  "location": "Dojo Principal",
  "coach_id": "{{userId}}",
  "max_capacity": 15,
  "is_recurring": true,
  "recurrence_rule": {
    "frequency": "weekly",
    "day_of_week": 1,
    "interval": 1,
    "count": 12
  },
  "status": "scheduled"
}

### 26. Récupérer tous les cours
GET {{baseUrl}}/courses

### 27. Récupérer tous les cours d'une organisation
GET {{baseUrl}}/courses?organizationId={{orgId}}

### 28. Récupérer les cours à venir (prochains 10)
GET {{baseUrl}}/courses/upcoming/{{orgId}}?limit=10

### 29. Récupérer les cours par plage de dates
GET {{baseUrl}}/courses/date-range/{{orgId}}?startDate=2025-11-01&endDate=2025-11-30

### 30. Récupérer un cours par ID
GET {{baseUrl}}/courses/{{courseId}}

### 31. Mettre à jour un cours
PATCH {{baseUrl}}/courses/{{courseId}}
Content-Type: application/json

{
  "title": "Krav Maga Débutants - MODIFIÉ",
  "max_capacity": 25
}

### 32. Annuler un cours
POST {{baseUrl}}/courses/{{courseId}}/cancel
Content-Type: application/json

{
  "reason": "Coach malade",
  "cancelFutureOccurrences": false
}

### 33. Annuler un cours et toutes les occurrences futures
POST {{baseUrl}}/courses/{{courseId}}/cancel
Content-Type: application/json

{
  "reason": "Fermeture du dojo pour travaux",
  "cancelFutureOccurrences": true
}

### 34. Supprimer un cours (soft delete)
DELETE {{baseUrl}}/courses/{{courseId}}

### 35. Restaurer un cours
POST {{baseUrl}}/courses/{{courseId}}/restore

### 36. Test validation - Devrait échouer (date de fin avant date de début)
POST {{baseUrl}}/courses
Content-Type: application/json

{
  "organization_id": "{{orgId}}",
  "title": "Test cours invalide",
  "start_datetime": "2025-11-03T20:00:00Z",
  "end_datetime": "2025-11-03T18:00:00Z",
  "coach_id": "{{userId}}"
}

###############################################################################
# AUTH ENDPOINTS
###############################################################################

### 37. S'inscrire (Register)
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "organization_id": "{{orgId}}",
  "email": "newuser@kravlyon.fr",
  "password": "SecurePassword123!",
  "first_name": "Nouveau",
  "last_name": "Membre",
  "phone": "0612345678",
  "role": "member"
}

### 38. Se connecter (Login)
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "admin@kravlyon.fr",
  "password": "SecurePassword123!"
}

### 39. Récupérer mon profil (nécessite JWT)
GET {{baseUrl}}/auth/me
Authorization: Bearer {{accessToken}}

### 40. Test - Login avec mauvais mot de passe (doit échouer)
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "admin@kravlyon.fr",
  "password": "wrongpassword"
}

### 41. Test - Login avec email inexistant (doit échouer)
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "nonexistent@example.com",
  "password": "SecurePassword123!"
}
